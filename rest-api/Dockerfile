FROM node:17-bullseye

WORKDIR /opt/rest-api

ENV DEPLOYMENTS_SERVICE_API_VERBOSE true
ENV DEPLOYMENTS_SERVICE_API_HOST localhost
ENV DEPLOYMENTS_SERVICE_API_PORT 3000
ENV DEPLOYMENTS_SERVICE_API_EXPOSE_DOCS true
ENV DEPLOYMENTS_SERVICE_REPOSITORY_TYPE memory 
ENV DEPLOYMENTS_SERVICE_REPOSITORY_USER test
ENV DEPLOYMENTS_SERVICE_REPOSITORY_PASSWORD test
ENV DEPLOYMENTS_SERVICE_REPOSITORY_HOST localhost
ENV DEPLOYMENTS_SERVICE_REPOSITORY_PORT 27017
ENV DEPLOYMENTS_SERVICE_REPOSITORY_SCHEMA test
ENV DEPLOYMENTS_SERVICE_API_VERSIONS *
ENV DEPLOYMENTS_SERVICE_DEPLOYMENTS_COUNT_FILE_PATH counts.txt

COPY package*.json ./
COPY tsconfig.json ./
COPY ./src/ ./src/
RUN npm install
RUN npm run build

CMD ["build/index.js"]

